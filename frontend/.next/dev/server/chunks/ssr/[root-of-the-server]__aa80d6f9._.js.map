{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/Synapse_Assessment/frontend/app/page.jsx"],"sourcesContent":["// 'use client';\n\n// import { useState, useRef, useEffect } from 'react';\n// import { useSearchParams } from 'next/navigation';\n// import { Send, Loader2, FileText, ArrowRight } from 'lucide-react';\n// import { Button } from '@/components/ui/button';\n// import { Textarea } from '@/components/ui/textarea';\n// import { Card, CardContent } from '@/components/ui/card';\n// import { ScrollArea } from '@/components/ui/scroll-area';\n// import { fetchAgentResponse } from '@/lib/streamingClient';\n// import { MessageBubble } from '@/components/MessageBubble.jsx';\n// import { FileUploadBox } from '@/components/FileUploadBox.jsx';\n// import { ThinkingIndicator } from '@/components/ThinkingIndicator.jsx';\n// import { useToast } from '@/components/ui/use-toast.js';\n// import { cn } from '@/lib/utils';\n// import { ThemeToggle } from '@/components/ThemeToggle.jsx';\n\nexport default function ChatPage() {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [isLoading, setIsLoading] = useState(false);\n  const [file, setFile] = useState(null);\n  const scrollRef = useRef(null);\n  const { toast } = useToast();\n\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n\n    if ((!input.trim() && !file) || isLoading) return;\n\n    const userMessage = {\n      id: Date.now(),\n      sender: 'user',\n      content: input.trim(),\n      file: file ? { name: file.name, type: file.type } : null,\n    };\n\n    setMessages((prev) => [...prev, userMessage]);\n    setInput('');\n    setIsLoading(true);\n\n    const formData = new FormData();\n    formData.append('message', input.trim() || `Analyze the uploaded file: ${file.name}`);\n    if (file) {\n      formData.append('file', file);\n      formData.append('fileType', file.type);\n      formData.append('fileName', file.name);\n    }\n    \n    // Clear file state after preparing formData\n    setFile(null); \n\n    try {\n      // Add a placeholder message for the streaming response\n      const agentMessageId = Date.now() + 1;\n      const placeholder = {\n        id: agentMessageId,\n        sender: 'agent',\n        content: '',\n        status: 'streaming',\n        metadata: {},\n      };\n\n      setMessages((prev) => [...prev, placeholder]);\n\n      await fetchAgentResponse(formData, (chunk) => {\n        setMessages((prev) => {\n          const newMessages = [...prev];\n          const currentMessageIndex = newMessages.findIndex((m) => m.id === agentMessageId);\n\n          if (currentMessageIndex !== -1) {\n            const currentMessage = newMessages[currentMessageIndex];\n            \n            // Handle different chunk types from the backend\n            if (chunk.type === 'text') {\n              currentMessage.content += chunk.data;\n            } else if (chunk.type === 'thought') {\n              // Update the latest thought or initialize\n              const thoughtText = chunk.data;\n              currentMessage.metadata.thought = thoughtText; \n            } else if (chunk.type === 'chart' || chunk.type === 'email_preview' || chunk.type === 'table') {\n              // Store final structured data\n              currentMessage.metadata.widget = { type: chunk.type, data: chunk.data };\n            } else if (chunk.type === 'error') {\n              currentMessage.content += `\\n\\n**ERROR:** ${chunk.data}`;\n            } else if (chunk.type === 'end' || chunk.type === 'final_output') {\n               currentMessage.status = 'complete';\n               delete currentMessage.metadata.thought;\n            }\n          }\n          return newMessages;\n        });\n      });\n\n    } catch (error) {\n      console.error(\"Streaming error:\", error);\n      toast({\n        title: \"Agent Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setMessages((prev) => \n        prev.map(m => m.id === Date.now() + 1 ? { ...m, content: (m.content || \"\") + `\\n\\n**Fatal Error:** ${error.message}`, status: 'complete' } : m)\n      );\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Auto-scroll to bottom on new message or update\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTo({\n        top: scrollRef.current.scrollHeight,\n        behavior: 'smooth',\n      });\n    }\n  }, [messages]);\n\n  return (\n    <div className=\"flex flex-col h-screen max-w-4xl mx-auto p-4 md:p-6\">\n      <header className=\"flex justify-between items-center pb-4 border-b\">\n        <h1 className=\"text-2xl font-bold flex items-center gap-2\">\n          <span className=\"text-primary\">Synapse</span> Agent ðŸ§ \n        </h1>\n        <ThemeToggle />\n      </header>\n\n      <ScrollArea className=\"flex-1 my-4 p-4 rounded-xl border bg-muted/20\" ref={scrollRef}>\n        <div className=\"flex flex-col space-y-4\">\n          {messages.length === 0 && (\n            <div className=\"flex flex-col items-center justify-center h-[60vh] text-center text-muted-foreground\">\n                <FileText className=\"w-12 h-12 mb-4 text-primary\" />\n                <h2 className=\"text-lg font-semibold\">Welcome to Synapse</h2>\n                <p className=\"max-w-xs\">Upload a CSV, PDF, or image and ask me to analyze, generate, or verify claims.</p>\n                <div className=\"mt-4\">\n                  <FileUploadBox setFile={setFile} />\n                </div>\n            </div>\n          )}\n          {messages.map((msg) => (\n            <MessageBubble key={msg.id} message={msg} setMessages={setMessages} />\n          ))}\n          {isLoading && <ThinkingIndicator text={messages.slice(-1)[0]?.metadata?.thought || \"Thinking...\"} />}\n        </div>\n      </ScrollArea>\n\n      <div className=\"mt-auto pt-4\">\n        <FileUploadBox file={file} setFile={setFile} disabled={isLoading} />\n        \n        <form onSubmit={handleSendMessage} className=\"flex items-end gap-2 mt-2\">\n          <Textarea\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Ask me to analyze your file, draft a letter, or verify claims...\"\n            disabled={isLoading}\n            rows={2}\n            className=\"flex-1 resize-none pr-10\"\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSendMessage(e);\n              }\n            }}\n          />\n          <Button type=\"submit\" size=\"icon\" disabled={isLoading || (!input.trim() && !file)}>\n            {isLoading ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <Send className=\"h-4 w-4\" />\n            )}\n          </Button>\n        </form>\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}