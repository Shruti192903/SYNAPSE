{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 13, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Desktop/Synapse_Assessment/frontend/app/page.jsx"],"sourcesContent":["// 'use client';\n\n// import { useState, useRef, useEffect } from 'react';\n// import { Send, Loader2, FileText, ArrowRight, X } from 'lucide-react';\n// import { Button } from '@/components/ui/button';\n// import { Textarea } from '@/components/ui/textarea';\n// import { Card, CardContent } from '@/components/ui/card';\n// import { ScrollArea } from '@/components/ui/scroll-area';\n// import { streamAgentResponse } from '@/lib/streamingClient';\n// import { MessageBubble } from '@/components/MessageBubble';\n// import { FileUploadBox } from '@/components/FileUploadBox';\n// import { ThinkingIndicator } from '@/components/ThinkingIndicator';\n// import { useToast } from '@/components/ui/use-toast';\n// import { cn } from '@/lib/utils';\n// import { ThemeToggle } from '@/components/ThemeToggle'; \n\n// export default function ChatPage() {\n//     const [messages, setMessages] = useState([]);\n//     const [input, setInput] = useState('');\n//     const [isLoading, setIsLoading] = useState(false);\n//     const [file, setFile] = useState(null);\n//     const scrollRef = useRef(null);\n//     const { toast } = useToast();\n\n//     // Scroll logic: scrolls to the bottom whenever messages change\n// // Scroll logic: scrolls to the bottom whenever messages change\n// useEffect(() => {\n//     if (scrollRef.current) {\n//         scrollRef.current.scrollTo({\n//             top: scrollRef.current.scrollHeight,\n//             behavior: 'smooth',\n//         });\n//     }\n// }, [messages]);\n\n// // Core logic to handle message sending and streaming\n// const handleSendMessage = async (e) => {\n//     e.preventDefault();\n//     // Prevent sending if no input/file or if already loading\n//     if ((!input.trim() && !file) || isLoading) return;\n\n\n//     const userMessage = {\n//         id: Date.now(),\n//         sender: 'user',\n//         content: input.trim(),\n//         file: file ? { name: file.name, type: file.type } : null,\n//     };\n\n\n//     // 1. Add user message to history\n//     setMessages((prev) => [...prev, userMessage]);\n//     setInput('');\n//     setIsLoading(true);\n\n\n//     const formData = new FormData();\n//     formData.append('message', userMessage.content || `Analyze the uploaded file: ${file.name}`);\n//     if (file) {\n//         formData.append('file', file);\n//         formData.append('fileType', file.type);\n//         formData.append('fileName', file.name);\n//     }\n    \n//     // Clear file state after preparing formData\n//     const agentMessageId = Date.now() + 1; // FIX: Declare in scope for catch/finally\n//     setFile(null); \n\n\n//     try {\n//         // 2. Add agent placeholder message\n        \n//         const placeholder = {\n//             id: agentMessageId,\n//             sender: 'agent',\n//             content: '',\n//             status: 'thinking',\n//             metadata: { thought: 'Connecting to agent...' },\n//         };\n//         setMessages((prev) => [...prev, placeholder]);\n\n\n//         // 3. Start streaming from the backend proxy\n//         await streamAgentResponse(formData, (chunk) => {\n//             setMessages((prev) => {\n//                 const newMessages = [...prev];\n//                 const currentMessageIndex = newMessages.findIndex((m) => m.id === agentMessageId);\n\n\n//                 if (currentMessageIndex !== -1) {\n//                     const currentMessage = newMessages[currentMessageIndex];\n                    \n//                     // Handle different chunk types from the backend\n//                     if (chunk.type === 'text') {\n//                         currentMessage.content += chunk.data;\n//                         currentMessage.status = 'streaming';\n//                         // Clear thought when streaming text begins\n//                         if (currentMessage.content.length > 0) {\n//                             delete currentMessage.metadata.thought;\n//                         }\n//                     } else if (chunk.type === 'thought') {\n//                         // Update the thinking indicator\n//                         currentMessage.metadata.thought = chunk.data; \n//                         currentMessage.status = 'thinking';\n//                     } else if (chunk.type === 'chart' || chunk.type === 'email_preview' || chunk.type === 'table') {\n//                         // Store final structured widget data\n//                         currentMessage.metadata.widget = { type: chunk.type, data: chunk.data };\n//                     } else if (chunk.type === 'error') {\n//                         currentMessage.content += `\\n\\n**ERROR:** ${chunk.data}`;\n//                     } else if (chunk.type === 'end' || chunk.type === 'final_output') {\n//                         // Signal completion\n//                         currentMessage.status = 'complete';\n//                         delete currentMessage.metadata.thought;\n//                     }\n//                 }\n//                 return newMessages;\n//             });\n//         });\n\n\n//     } catch (error) {\n//         console.error(\"Streaming error:\", error);\n//         const errorMessage = error.message || \"Unknown communication error.\";\n//         toast({\n//             title: \"Agent Error\",\n//             description: `Request failed: ${errorMessage}`,\n//             variant: \"destructive\",\n//         });\n//         // Update the agent message with the error (FIXED SYNTAX)\n//         setMessages((prev) => \n//             prev.map(m => m.id === agentMessageId ? { \n//                 ...m, \n//                 content: (m.content || \"\") + `\\n\\n**Fatal Error:** ${errorMessage}`, \n//                 status: 'complete', \n//                 metadata: {} \n//             } : m)\n//         );\n//     } finally {\n//         setIsLoading(false);\n//     }\n// };\n\n// const handleKeyDown = (e) => {\n//     if (e.key === 'Enter' && !e.shiftKey) {\n//         e.preventDefault();\n//         handleSendMessage(e);\n//     }\n// };\n\n// return (\n//     // Full screen container for the application\n//     <div className=\"flex flex-col h-screen bg-background text-foreground font-sans\">\n        \n//         {/* Header */}\n//         <header className=\"flex items-center justify-between px-6 py-4 border-b border-border/50 bg-card/80 backdrop-blur-sm shadow-md z-10\">\n//             <h1 className=\"text-3xl font-extrabold tracking-tight text-primary flex items-center gap-3\">\n//                 Synapse <span className=\"text-xl font-medium text-muted-foreground\">Agent ðŸ§ </span>\n//             </h1>\n//             <ThemeToggle />\n//         </header>\n\n\n//         {/* Main Content Area */}\n//         <main className=\"flex-1 overflow-hidden relative\">\n//             {/* Scroll Area must contain full height content to enable vertical centering in the empty state */}\n//             <ScrollArea ref={scrollRef} className=\"h-full w-full\">\n//                 <div className=\"max-w-4xl mx-auto h-full\"> \n                    \n//                     {messages.length === 0 ? (\n                        \n//                         <div className=\"flex flex-col items-center justify-center min-h-[calc(100vh-100px)] text-center px-4 md:px-8 py-16\">\n                            \n//                             <Card className=\"max-w-3xl w-full p-8 md:p-12 bg-card/70 shadow-2xl shadow-primary/10 rounded-2xl border border-border/50 transition-all duration-300 hover:shadow-primary/20\">\n                                \n//                                 <FileText className=\"w-10 h-10 mb-6 text-primary mx-auto opacity-80\" />\n                                \n//                                 <h2 className=\"text-4xl md:text-5xl font-extrabold tracking-tighter text-foreground mb-4\">\n//                                     <span className=\"text-primary\">Synapse</span> Knowledge Workspace\n//                                 </h2>\n                                \n//                                 <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto mb-10 tracking-tight leading-relaxed\">\n//                                     Your autonomous agent for **advanced data analysis, contract drafting, and real-time claim verification** across PDFs, CSVs, and images.\n//                                 </p>\n                                \n//                                 {/* Centralized Input/Action Area */}\n//                                 <div className=\"flex flex-col items-center space-y-4\">\n                                    \n//                                     <FileUploadBox file={file} setFile={setFile} disabled={isLoading} />\n                                    \n//                                     {/* Combined Input and Button */}\n//                                     <div className=\"flex w-full max-w-lg items-end gap-3\">\n//                                         <Textarea\n//                                             value={input}\n//                                             onChange={(e) => setInput(e.target.value)}\n//                                             onKeyDown={handleKeyDown}\n//                                             placeholder={file ? `Attached file: ${file.name}. Ask for analysis or drafting...` : 'Ask a general question or describe your task...'}\n//                                             className=\"min-h-[50px] resize-none border-2 shadow-inner focus:ring-2 focus:ring-primary/50\"\n//                                             rows={1}\n//                                         />\n//                                         <Button \n//                                             onClick={handleSendMessage} \n//                                             disabled={isLoading || (!input.trim() && !file)} \n//                                             size=\"icon\" \n//                                             className=\"h-[50px] w-[50px] shrink-0 text-lg transition-all duration-200\"\n//                                         >\n//                                             {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <Send className=\"h-5 w-5\" />}\n//                                         </Button>\n//                                     </div>\n//                                 </div>\n//                             </Card>\n\n\n//                         </div>\n//                     ) : (\n//                         // *** CHAT MESSAGE RENDERING (when history exists) ***\n//                         <div className=\"p-4 md:p-6 pb-24 space-y-6\"> {/* Added pb-24 for padding above sticky input */}\n//                             {messages.map((msg, index) => (\n//                                 <MessageBubble key={index} message={msg} setMessages={setMessages} />\n//                             ))}\n//                             {isLoading && <ThinkingIndicator text={messages.slice(-1)?.metadata?.thought || \"Thinking...\"} />}\n//                         </div>\n//                     )}\n//                 </div>\n//             </ScrollArea>\n//         </main>\n\n\n//         {/* Sticky Input Area (Always visible when chat history exists) */}\n//         {messages.length > 0 && (\n//             <div className=\"absolute bottom-0 left-0 right-0 px-6 py-4 bg-background border-t border-border/50 shadow-2xl z-10\">\n//                 <div className=\"max-w-3xl mx-auto flex items-end gap-3\">\n                    \n//                     {/* Compact File Indicator/Remover */}\n//                     {file && (\n//                         <Card className=\"absolute -top-14 left-1/2 -translate-x-1/2 bg-card p-2 text-sm flex items-center gap-2 rounded-lg border-primary/50 shadow-md\">\n//                             <FileText className=\"w-4 h-4 text-primary\" />\n//                             <span>{file.name}</span>\n//                             <Button variant=\"ghost\" size=\"sm\" onClick={() => setFile(null)} className=\"h-auto p-1 opacity-70 hover:opacity-100\">\n//                                 <X className=\"w-3 h-3\" />\n//                             </Button>\n//                         </Card>\n//                     )}\n                    \n//                     <Textarea\n//                         value={input}\n//                         onChange={(e) => setInput(e.target.value)}\n//                         onKeyDown={handleKeyDown}\n//                         placeholder=\"Continue the conversation...\"\n//                         className=\"min-h-[50px] resize-none pr-10\"\n//                         rows={1}\n//                     />\n//                     <Button onClick={handleSendMessage} disabled={isLoading || (!input.trim() && !file)} size=\"icon\" className=\"h-[50px] w-[50px] shrink-0\">\n//                         {isLoading ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : <Send className=\"h-5 w-5\" />}\n//                     </Button>\n//                 </div>\n//             </div>\n//         )}\n//     </div>\n// )\n// }\n\n\n// page.jsx\nconst [messages, setMessages] = useState([]);\n\nconst handleSendMessage = async (file) => {\n  const formData = new FormData();\n  formData.append(\"file\", file);\n\n  // Show temporary processing indicator\n  const processingId = Date.now();\n  setMessages((prev) => [...prev, { id: processingId, type: \"status\", data: \"Processing...\" }]);\n\n  await streamAgentResponse(formData, (chunk) => {\n    // Remove processing indicator\n    setMessages((prev) => prev.filter((m) => m.id !== processingId));\n\n    // Append final summary\n    setMessages((prev) => [...prev, { id: Date.now(), type: chunk.type, data: chunk.data }]);\n  });\n};\n\n"],"names":[],"mappings":"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"}}]
}